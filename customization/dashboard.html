<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Overlay Customization</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4285F4;
            --secondary-color: #3367D6;
            --bg-color: #202124;
            --panel-bg: #303134;
            --text-color: #e8eaed;
            --border-color: #5f6368;
            --success-color: #81c995;
            --error-color: #f28b82;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        h2 {
            font-size: 20px;
            font-weight: 600;
            margin: 20px 0 15px;
        }

        .card {
            background-color: var(--panel-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .preview-section {
            grid-column: 1 / -1;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input[type="text"],
        input[type="number"],
        input[type="color"],
        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: #3c4043;
            color: var(--text-color);
            font-size: 14px;
        }

        input[type="range"] {
            width: 100%;
        }

        .range-value {
            display: inline-block;
            margin-left: 10px;
            font-size: 14px;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: var(--secondary-color);
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .reset-btn {
            background-color: #f28b82;
        }

        .reset-btn:hover {
            background-color: #ea4335;
        }

        #status-message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: center;
            display: none;
        }

        .success {
            background-color: var(--success-color);
            color: #202124;
        }

        .error {
            background-color: var(--error-color);
            color: #202124;
        }

        .preview {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .preview-chat {
            height: 200px;
            overflow-y: auto;
        }

        .preview-message {
            margin-bottom: 8px;
            padding: 8px 10px;
            border-radius: 4px;
            background-color: rgba(34, 34, 34, 0.7);
            border-left: 3px solid #ff0000;
        }

        .preview-message:last-child {
            border-left: 3px solid #9146FF;
        }

        .preview-username {
            font-weight: bold;
            margin-right: 5px;
        }

        .preview-username.youtube {
            color: #ff0000;
        }

        .preview-username.twitch {
            color: #9146FF;
        }

        .preview-highlight {
            padding: 15px;
            background-color: rgba(40, 40, 40, 0.9);
            border-radius: 8px;
            border-left: 5px solid #ff5500;
            margin: 10px auto;
            width: 80%;
        }

        .info-links {
            margin-top: 40px;
            text-align: center;
            font-size: 14px;
            color: #9aa0a6;
        }

        .info-links a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .info-links a:hover {
            text-decoration: underline;
        }

        .ports-info {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            gap: 10px;
        }

        .port-card {
            flex: 1;
            background-color: var(--panel-bg);
            border-radius: 4px;
            padding: 15px;
            text-align: center;
        }

        .port-card h3 {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .port-card a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 14px;
        }

        .port-card a:hover {
            text-decoration: underline;
        }
        
        /* Tab styling */
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab-button {
            padding: 10px 15px;
            background-color: var(--panel-bg);
            border: none;
            color: var(--text-color);
            cursor: pointer;
            border-radius: 4px 4px 0 0;
            margin-right: 2px;
        }
        
        .tab-button.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        .checkbox-group {
            margin: 5px 0;
        }

        .color-picker {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .color-picker label {
            flex: 1;
            margin-bottom: 0;
        }

        .color-picker input[type="color"] {
            width: 40px;
            height: 25px;
            border: none;
            border-radius: 4px;
        }
        
        .range-slider {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }
        
        .range-slider label {
            width: auto;
            margin-right: 10px;
        }
        
        .range-slider input[type="range"] {
            flex: 1;
        }
    </style>
</head>

<body>
    <header>
        <h1>OBS Multi-Platform Chat Overlay Customization</h1>
        <p>Customize the appearance and behavior of your YouTube and Twitch chat overlay</p>
    </header>

    <div id="status-message"></div>

    <div class="ports-info">
        <div class="port-card">
            <h3>OBS View</h3>
            <p>Add to OBS as Browser Source</p>
            <a href="http://localhost:3000/obs-view" target="_blank">http://localhost:3000/obs-view</a>
        </div>
        <div class="port-card">
            <h3>Streamer View</h3>
            <p>View on your monitor</p>
            <a href="http://localhost:3000/streamer-view" target="_blank">http://localhost:3000/streamer-view</a>
        </div>
        <div class="port-card">
            <h3>Highlighted Messages</h3>
            <p>Add to OBS as Browser Source</p>
            <a href="http://localhost:3001" target="_blank">http://localhost:3001</a>
        </div>
        <div class="port-card">
            <h3>Customization Dashboard</h3>
            <p>Current page</p>
            <a href="http://localhost:3002" target="_blank">http://localhost:3002</a>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-button active" data-tab="obs-tab">OBS View</button>
        <button class="tab-button" data-tab="streamer-tab">Streamer View</button>
        <button class="tab-button" data-tab="common-tab">Common Settings</button>
    </div>

    <div id="obs-tab" class="tab-content active">
        <div class="card">
            <h2>OBS View Customization</h2>
            <div class="form-group">
                <label for="obs-fontSize">Font Size</label>
                <input type="range" id="obs-fontSize" min="12" max="24" step="1" value="16">
                <span id="obs-fontSizeValue" class="range-value">16px</span>
            </div>
            <div class="form-group">
                <label for="obs-textColor">Text Color</label>
                <input type="color" id="obs-textColor" value="#ffffff">
            </div>
            <div class="form-group">
                <label for="obs-backgroundColor">Background Color</label>
                <input type="color" id="obs-backgroundColor" value="#222222">
            </div>
            <div class="form-group">
                <label for="obs-messageBackgroundColor">Message Background</label>
                <input type="color" id="obs-messageBackgroundColor" value="#222222">
                <div class="range-slider">
                    <label for="obs-messageOpacity">Opacity: </label>
                    <input type="range" id="obs-messageOpacity" min="0" max="1" step="0.1" value="0.7">
                    <span id="obs-messageOpacityValue" class="range-value">0.7</span>
                </div>
            </div>
            <div class="form-group">
                <label for="obs-messageBorderRadius">Corner Roundness</label>
                <input type="range" id="obs-messageBorderRadius" min="0" max="20" step="1" value="4">
                <span id="obs-messageBorderRadiusValue" class="range-value">4px</span>
            </div>
            <div class="form-group">
                <label for="obs-messagePadding">Message Padding</label>
                <input type="range" id="obs-messagePadding" min="4" max="20" step="1" value="8">
                <span id="obs-messagePaddingValue" class="range-value">8px</span>
            </div>
            <div class="form-group">
                <label for="obs-chatWidth">Chat Width</label>
                <input type="text" id="obs-chatWidth" value="100%">
            </div>
            <div class="form-group">
                <label for="obs-chatHeight">Chat Height</label>
                <input type="text" id="obs-chatHeight" value="400px">
            </div>
            <div class="form-group">
                <label>Text Shadow:</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="obs-enableDropShadow" checked>
                    <label for="obs-enableDropShadow">Enable Drop Shadow</label>
                </div>
            </div>
            <div class="form-group">
                <label for="obs-theme">Theme:</label>
                <select id="obs-theme">
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                </select>
            </div>
            <div class="form-group">
                <label>Display Options:</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="obs-showBadges" checked>
                    <label for="obs-showBadges">Show Badges</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="obs-showTimestamps">
                    <label for="obs-showTimestamps">Show Timestamps</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="obs-showPlatforms" checked>
                    <label for="obs-showPlatforms">Show Platform Icons</label>
                </div>
            </div>
        </div>
    </div>

    <div id="streamer-tab" class="tab-content">
        <div class="card">
            <h2>Streamer View Customization</h2>
            <div class="form-group">
                <label for="streamer-fontSize">Font Size</label>
                <input type="range" id="streamer-fontSize" min="12" max="24" step="1" value="16">
                <span id="streamer-fontSizeValue" class="range-value">16px</span>
            </div>
            <div class="form-group">
                <label for="streamer-textColor">Text Color</label>
                <input type="color" id="streamer-textColor" value="#ffffff">
            </div>
            <div class="form-group">
                <label for="streamer-backgroundColor">Background Color</label>
                <input type="color" id="streamer-backgroundColor" value="#181818">
            </div>
            <div class="form-group">
                <label for="streamer-messageBackgroundColor">Message Background</label>
                <input type="color" id="streamer-messageBackgroundColor" value="#222222">
                <div class="range-slider">
                    <label for="streamer-messageOpacity">Opacity: </label>
                    <input type="range" id="streamer-messageOpacity" min="0" max="1" step="0.1" value="0.7">
                    <span id="streamer-messageOpacityValue" class="range-value">0.7</span>
                </div>
            </div>
            <div class="form-group">
                <label for="streamer-messageBorderRadius">Corner Roundness</label>
                <input type="range" id="streamer-messageBorderRadius" min="0" max="20" step="1" value="4">
                <span id="streamer-messageBorderRadiusValue" class="range-value">4px</span>
            </div>
            <div class="form-group">
                <label for="streamer-messagePadding">Message Padding</label>
                <input type="range" id="streamer-messagePadding" min="4" max="20" step="1" value="8">
                <span id="streamer-messagePaddingValue" class="range-value">8px</span>
            </div>
            <div class="form-group">
                <label for="streamer-chatWidth">Chat Width</label>
                <input type="text" id="streamer-chatWidth" value="100%">
            </div>
            <div class="form-group">
                <label for="streamer-chatHeight">Chat Height</label>
                <input type="text" id="streamer-chatHeight" value="400px">
            </div>
            <div class="form-group">
                <label>Text Shadow:</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="streamer-enableDropShadow" checked>
                    <label for="streamer-enableDropShadow">Enable Drop Shadow</label>
                </div>
            </div>
            <div class="form-group">
                <label for="streamer-theme">Theme:</label>
                <select id="streamer-theme">
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                </select>
            </div>
            <div class="form-group">
                <label>Display Options:</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="streamer-showBadges" checked>
                    <label for="streamer-showBadges">Show Badges</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="streamer-showTimestamps">
                    <label for="streamer-showTimestamps">Show Timestamps</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="streamer-showPlatforms" checked>
                    <label for="streamer-showPlatforms">Show Platform Icons</label>
                </div>
            </div>
        </div>
    </div>
    <div id="common-tab" class="tab-content">
        <div class="card">
            <h2>Common Settings</h2>
            <div class="form-group">
                <label for="messageLimit">Maximum Messages</label>
                <input type="number" id="messageLimit" min="10" max="200" value="50">
            </div>
            <div class="form-group">
                <label for="highlightTimeout">Highlight Timeout (seconds)</label>
                <input type="range" id="highlightTimeout" min="1" max="30" step="1" value="10">
                <span id="highlightTimeoutValue" class="range-value">10s</span>
            </div>
            <div class="form-group">
                <label for="highlightColor">Highlight Color</label>
                <input type="color" id="highlightColor" value="#ff5500">
            </div>
        </div>
    </div>

    <div class="buttons">
        <button id="resetSettings" class="reset-btn">Reset to Defaults</button>
        <button id="saveSettings">Save Settings</button>
    </div>

    <div class="info-links">
        <p>Add these URLs as Browser Sources in OBS Studio</p>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Get DOM elements - OBS View
            const obsFontSizeInput = document.getElementById('obs-fontSize');
            const obsFontSizeValue = document.getElementById('obs-fontSizeValue');
            const obsTextColorInput = document.getElementById('obs-textColor');
            const obsBackgroundColorInput = document.getElementById('obs-backgroundColor');
            const obsChatWidthInput = document.getElementById('obs-chatWidth');
            const obsChatHeightInput = document.getElementById('obs-chatHeight');
            const obsEnableDropShadowInput = document.getElementById('obs-enableDropShadow');
            const obsThemeInput = document.getElementById('obs-theme');
            const obsShowBadgesInput = document.getElementById('obs-showBadges');
            const obsShowTimestampsInput = document.getElementById('obs-showTimestamps');
            const obsShowPlatformsInput = document.getElementById('obs-showPlatforms');
            const obsMsgBgColorInput = document.getElementById('obs-messageBackgroundColor');
            const obsMsgOpacityInput = document.getElementById('obs-messageOpacity');
            const obsMsgOpacityValue = document.getElementById('obs-messageOpacityValue');
            const obsMsgBorderRadiusInput = document.getElementById('obs-messageBorderRadius');
            const obsMsgBorderRadiusValue = document.getElementById('obs-messageBorderRadiusValue');
            const obsMsgPaddingInput = document.getElementById('obs-messagePadding');
            const obsMsgPaddingValue = document.getElementById('obs-messagePaddingValue');
            
            // Get DOM elements - Streamer View
            const streamerFontSizeInput = document.getElementById('streamer-fontSize');
            const streamerFontSizeValue = document.getElementById('streamer-fontSizeValue');
            const streamerTextColorInput = document.getElementById('streamer-textColor');
            const streamerBackgroundColorInput = document.getElementById('streamer-backgroundColor');
            const streamerChatWidthInput = document.getElementById('streamer-chatWidth');
            const streamerChatHeightInput = document.getElementById('streamer-chatHeight');
            const streamerEnableDropShadowInput = document.getElementById('streamer-enableDropShadow');
            const streamerThemeInput = document.getElementById('streamer-theme');
            const streamerShowBadgesInput = document.getElementById('streamer-showBadges');
            const streamerShowTimestampsInput = document.getElementById('streamer-showTimestamps');
            const streamerShowPlatformsInput = document.getElementById('streamer-showPlatforms');
            const streamerMsgBgColorInput = document.getElementById('streamer-messageBackgroundColor');
            const streamerMsgOpacityInput = document.getElementById('streamer-messageOpacity');
            const streamerMsgOpacityValue = document.getElementById('streamer-messageOpacityValue');
            const streamerMsgBorderRadiusInput = document.getElementById('streamer-messageBorderRadius');
            const streamerMsgBorderRadiusValue = document.getElementById('streamer-messageBorderRadiusValue');
            const streamerMsgPaddingInput = document.getElementById('streamer-messagePadding');
            const streamerMsgPaddingValue = document.getElementById('streamer-messagePaddingValue');
            
            // Get DOM elements - Common
            const messageLimitInput = document.getElementById('messageLimit');
            const highlightTimeoutInput = document.getElementById('highlightTimeout');
            const highlightTimeoutValue = document.getElementById('highlightTimeoutValue');
            const highlightColorInput = document.getElementById('highlightColor');
            
            const saveButton = document.getElementById('saveSettings');
            const resetButton = document.getElementById('resetSettings');
            const statusMessage = document.getElementById('status-message');

            // Tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all tabs
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    button.classList.add('active');
                    document.getElementById(button.dataset.tab).classList.add('active');
                });
            });

            // Default settings
            const defaultSettings = {
                messageLimit: 50,
                highlightTimeout: 10000,
                highlightColor: "#ff5500",
                
                obsView: {
                    fontSize: 16,
                    textColor: "#ffffff",
                    backgroundColor: "#222222",
                    messageBackgroundColor: "#222222",
                    messageOpacity: 0.7,
                    messageBorderRadius: 4,
                    messagePadding: 8,
                    chatWidth: "100%",
                    chatHeight: "400px",
                    enableDropShadow: true,
                    theme: "dark",
                    showBadges: true,
                    showTimestamps: false,
                    showPlatforms: true
                },
                
                streamerView: {
                    fontSize: 16,
                    textColor: "#ffffff",
                    backgroundColor: "#181818",
                    messageBackgroundColor: "#222222",
                    messageOpacity: 0.7,
                    messageBorderRadius: 4,
                    messagePadding: 8,
                    chatWidth: "100%",
                    chatHeight: "400px",
                    enableDropShadow: true,
                    theme: "dark",
                    showBadges: true,
                    showTimestamps: false,
                    showPlatforms: true
                }
            };

            // Connect to Socket.IO
            const socket = io();

            // Handle settings received from server
            socket.on('settings', (settings) => {
                updateUIFromSettings(settings);
            });

            // Handle settings updates from other clients
            socket.on('settings-updated', (settings) => {
                updateUIFromSettings(settings);
                showStatus('Settings updated', 'success');
            });

            // Update UI from settings object
            function updateUIFromSettings(settings) {
                // Update OBS View form inputs
                if (settings.obsView) {
                    obsFontSizeInput.value = settings.obsView.fontSize || defaultSettings.obsView.fontSize;
                    obsFontSizeValue.textContent = `${settings.obsView.fontSize || defaultSettings.obsView.fontSize}px`;
                    obsTextColorInput.value = settings.obsView.textColor || defaultSettings.obsView.textColor;
                    obsBackgroundColorInput.value = settings.obsView.backgroundColor || defaultSettings.obsView.backgroundColor;
                    obsChatWidthInput.value = settings.obsView.chatWidth || defaultSettings.obsView.chatWidth;
                    obsChatHeightInput.value = settings.obsView.chatHeight || defaultSettings.obsView.chatHeight;
                    obsEnableDropShadowInput.checked = settings.obsView.enableDropShadow !== undefined ? settings.obsView.enableDropShadow : defaultSettings.obsView.enableDropShadow;
                    obsThemeInput.value = settings.obsView.theme || defaultSettings.obsView.theme;
                    obsShowBadgesInput.checked = settings.obsView.showBadges !== undefined ? settings.obsView.showBadges : defaultSettings.obsView.showBadges;
                    obsShowTimestampsInput.checked = settings.obsView.showTimestamps !== undefined ? settings.obsView.showTimestamps : defaultSettings.obsView.showTimestamps;
                    obsShowPlatformsInput.checked = settings.obsView.showPlatforms !== undefined ? settings.obsView.showPlatforms : defaultSettings.obsView.showPlatforms;
                    
                    // New message box customization options
                    obsMsgBgColorInput.value = settings.obsView.messageBackgroundColor || defaultSettings.obsView.messageBackgroundColor;
                    obsMsgOpacityInput.value = settings.obsView.messageOpacity || defaultSettings.obsView.messageOpacity;
                    obsMsgOpacityValue.textContent = settings.obsView.messageOpacity || defaultSettings.obsView.messageOpacity;
                    obsMsgBorderRadiusInput.value = settings.obsView.messageBorderRadius || defaultSettings.obsView.messageBorderRadius;
                    obsMsgBorderRadiusValue.textContent = `${settings.obsView.messageBorderRadius || defaultSettings.obsView.messageBorderRadius}px`;
                    obsMsgPaddingInput.value = settings.obsView.messagePadding || defaultSettings.obsView.messagePadding;
                    obsMsgPaddingValue.textContent = `${settings.obsView.messagePadding || defaultSettings.obsView.messagePadding}px`;
                }
                
                // Update Streamer View form inputs
                if (settings.streamerView) {
                    streamerFontSizeInput.value = settings.streamerView.fontSize || defaultSettings.streamerView.fontSize;
                    streamerFontSizeValue.textContent = `${settings.streamerView.fontSize || defaultSettings.streamerView.fontSize}px`;
                    streamerTextColorInput.value = settings.streamerView.textColor || defaultSettings.streamerView.textColor;
                    streamerBackgroundColorInput.value = settings.streamerView.backgroundColor || defaultSettings.streamerView.backgroundColor;
                    streamerChatWidthInput.value = settings.streamerView.chatWidth || defaultSettings.streamerView.chatWidth;
                    streamerChatHeightInput.value = settings.streamerView.chatHeight || defaultSettings.streamerView.chatHeight;
                    streamerEnableDropShadowInput.checked = settings.streamerView.enableDropShadow !== undefined ? settings.streamerView.enableDropShadow : defaultSettings.streamerView.enableDropShadow;
                    streamerThemeInput.value = settings.streamerView.theme || defaultSettings.streamerView.theme;
                    streamerShowBadgesInput.checked = settings.streamerView.showBadges !== undefined ? settings.streamerView.showBadges : defaultSettings.streamerView.showBadges;
                    streamerShowTimestampsInput.checked = settings.streamerView.showTimestamps !== undefined ? settings.streamerView.showTimestamps : defaultSettings.streamerView.showTimestamps;
                    streamerShowPlatformsInput.checked = settings.streamerView.showPlatforms !== undefined ? settings.streamerView.showPlatforms : defaultSettings.streamerView.showPlatforms;
                    
                    // New message box customization options
                    streamerMsgBgColorInput.value = settings.streamerView.messageBackgroundColor || defaultSettings.streamerView.messageBackgroundColor;
                    streamerMsgOpacityInput.value = settings.streamerView.messageOpacity || defaultSettings.streamerView.messageOpacity;
                    streamerMsgOpacityValue.textContent = settings.streamerView.messageOpacity || defaultSettings.streamerView.messageOpacity;
                    streamerMsgBorderRadiusInput.value = settings.streamerView.messageBorderRadius || defaultSettings.streamerView.messageBorderRadius;
                    streamerMsgBorderRadiusValue.textContent = `${settings.streamerView.messageBorderRadius || defaultSettings.streamerView.messageBorderRadius}px`;
                    streamerMsgPaddingInput.value = settings.streamerView.messagePadding || defaultSettings.streamerView.messagePadding;
                    streamerMsgPaddingValue.textContent = `${settings.streamerView.messagePadding || defaultSettings.streamerView.messagePadding}px`;
                }
                
                // Update Common form inputs
                messageLimitInput.value = settings.messageLimit || defaultSettings.messageLimit;
                
                // Convert milliseconds to seconds for display
                const timeoutInSeconds = (settings.highlightTimeout || defaultSettings.highlightTimeout) / 1000;
                highlightTimeoutInput.value = timeoutInSeconds;
                highlightTimeoutValue.textContent = `${timeoutInSeconds}s`;
                
                highlightColorInput.value = settings.highlightColor || defaultSettings.highlightColor;
            }

            // Get current settings from inputs
            function getSettingsFromUI() {
                return {
                    messageLimit: parseInt(messageLimitInput.value) || defaultSettings.messageLimit,
                    highlightTimeout: parseInt(highlightTimeoutInput.value) * 1000 || defaultSettings.highlightTimeout,
                    highlightColor: highlightColorInput.value || defaultSettings.highlightColor,
                    
                    obsView: {
                        fontSize: parseInt(obsFontSizeInput.value) || defaultSettings.obsView.fontSize,
                        textColor: obsTextColorInput.value || defaultSettings.obsView.textColor,
                        backgroundColor: obsBackgroundColorInput.value || defaultSettings.obsView.backgroundColor,
                        messageBackgroundColor: obsMsgBgColorInput.value || defaultSettings.obsView.messageBackgroundColor,
                        messageOpacity: parseFloat(obsMsgOpacityInput.value) || defaultSettings.obsView.messageOpacity,
                        messageBorderRadius: parseInt(obsMsgBorderRadiusInput.value) || defaultSettings.obsView.messageBorderRadius,
                        messagePadding: parseInt(obsMsgPaddingInput.value) || defaultSettings.obsView.messagePadding,
                        chatWidth: obsChatWidthInput.value || defaultSettings.obsView.chatWidth,
                        chatHeight: obsChatHeightInput.value || defaultSettings.obsView.chatHeight,
                        enableDropShadow: obsEnableDropShadowInput.checked,
                        theme: obsThemeInput.value || defaultSettings.obsView.theme,
                        showBadges: obsShowBadgesInput.checked,
                        showTimestamps: obsShowTimestampsInput.checked,
                        showPlatforms: obsShowPlatformsInput.checked
                    },
                    
                    streamerView: {
                        fontSize: parseInt(streamerFontSizeInput.value) || defaultSettings.streamerView.fontSize,
                        textColor: streamerTextColorInput.value || defaultSettings.streamerView.textColor,
                        backgroundColor: streamerBackgroundColorInput.value || defaultSettings.streamerView.backgroundColor,
                        messageBackgroundColor: streamerMsgBgColorInput.value || defaultSettings.streamerView.messageBackgroundColor,
                        messageOpacity: parseFloat(streamerMsgOpacityInput.value) || defaultSettings.streamerView.messageOpacity,
                        messageBorderRadius: parseInt(streamerMsgBorderRadiusInput.value) || defaultSettings.streamerView.messageBorderRadius,
                        messagePadding: parseInt(streamerMsgPaddingInput.value) || defaultSettings.streamerView.messagePadding,
                        chatWidth: streamerChatWidthInput.value || defaultSettings.streamerView.chatWidth,
                        chatHeight: streamerChatHeightInput.value || defaultSettings.streamerView.chatHeight,
                        enableDropShadow: streamerEnableDropShadowInput.checked,
                        theme: streamerThemeInput.value || defaultSettings.streamerView.theme,
                        showBadges: streamerShowBadgesInput.checked,
                        showTimestamps: streamerShowTimestampsInput.checked,
                        showPlatforms: streamerShowPlatformsInput.checked
                    }
                };
            }

            // Show status message
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = type;
                statusMessage.style.display = 'block';
                
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 3000);
            }

            // Event listeners for real-time updates
            obsFontSizeInput.addEventListener('input', () => {
                obsFontSizeValue.textContent = `${obsFontSizeInput.value}px`;
            });

            streamerFontSizeInput.addEventListener('input', () => {
                streamerFontSizeValue.textContent = `${streamerFontSizeInput.value}px`;
            });

            obsMsgOpacityInput.addEventListener('input', () => {
                obsMsgOpacityValue.textContent = obsMsgOpacityInput.value;
            });

            obsMsgBorderRadiusInput.addEventListener('input', () => {
                obsMsgBorderRadiusValue.textContent = `${obsMsgBorderRadiusInput.value}px`;
            });

            obsMsgPaddingInput.addEventListener('input', () => {
                obsMsgPaddingValue.textContent = `${obsMsgPaddingInput.value}px`;
            });

            streamerMsgOpacityInput.addEventListener('input', () => {
                streamerMsgOpacityValue.textContent = streamerMsgOpacityInput.value;
            });

            streamerMsgBorderRadiusInput.addEventListener('input', () => {
                streamerMsgBorderRadiusValue.textContent = `${streamerMsgBorderRadiusInput.value}px`;
            });

            streamerMsgPaddingInput.addEventListener('input', () => {
                streamerMsgPaddingValue.textContent = `${streamerMsgPaddingInput.value}px`;
            });

            highlightTimeoutInput.addEventListener('input', () => {
                highlightTimeoutValue.textContent = `${highlightTimeoutInput.value}s`;
            });

            // Save settings
            saveButton.addEventListener('click', () => {
                const settings = getSettingsFromUI();
                
                // Send settings to server
                fetch('/api/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showStatus('Settings saved successfully', 'success');
                    } else {
                        showStatus('Error saving settings', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error saving settings:', error);
                    showStatus('Error saving settings', 'error');
                });
            });

            // Reset to defaults
            resetButton.addEventListener('click', () => {
                if (confirm('Are you sure you want to reset all settings to defaults?')) {
                    updateUIFromSettings(defaultSettings);
                    
                    // Send settings to server
                    fetch('/api/settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(defaultSettings)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showStatus('Settings reset to defaults', 'success');
                        } else {
                            showStatus('Error resetting settings', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error resetting settings:', error);
                        showStatus('Error resetting settings', 'error');
                    });
                }
            });

            // Fetch current settings on load
            fetch('/api/settings')
                .then(response => response.json())
                .then(settings => {
                    updateUIFromSettings(settings);
                })
                .catch(error => {
                    console.error('Error fetching settings:', error);
                    showStatus('Error fetching settings', 'error');
                    // Fall back to defaults
                    updateUIFromSettings(defaultSettings);
                });
        });
    </script>
</body>
</html>